(function(t,e){if(typeof define=="function"&&define.amd){define(e)}else if(typeof module=="object"&&module.exports){module.exports=e()}else{t.EvEmitter=e()}})(typeof window!="undefined"?window:this,function(){"use strict";function t(){}var e=t.prototype;e.on=function(t,e){if(!t||!e){return}var n=this._events=this._events||{};var i=n[t]=n[t]||[];if(i.indexOf(e)==-1){i.push(e)}return this};e.once=function(t,e){if(!t||!e){return}this.on(t,e);var n=this._onceEvents=this._onceEvents||{};var i=n[t]=n[t]||{};i[e]=true;return this};e.off=function(t,e){var n=this._events&&this._events[t];if(!n||!n.length){return}var i=n.indexOf(e);if(i!=-1){n.splice(i,1)}return this};e.emitEvent=function(t,e){var n=this._events&&this._events[t];if(!n||!n.length){return}n=n.slice(0);e=e||[];var i=this._onceEvents&&this._onceEvents[t];for(var o=0;o<n.length;o++){var r=n[o];var a=i&&i[r];if(a){this.off(t,r);delete i[r]}r.apply(this,e)}return this};e.allOff=function(){delete this._events;delete this._onceEvents};return t});(function(e,n){if(typeof define=="function"&&define.amd){define(["ev-emitter/ev-emitter"],function(t){return n(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=n(e,require("ev-emitter"))}else{e.Unipointer=n(e,e.EvEmitter)}})(window,function t(o,e){"use strict";function n(){}function i(){}var r=i.prototype=Object.create(e.prototype);r.bindStartEvent=function(t){this._bindStartEvent(t,true)};r.unbindStartEvent=function(t){this._bindStartEvent(t,false)};r._bindStartEvent=function(t,e){e=e===undefined?true:e;var n=e?"addEventListener":"removeEventListener";var i="mousedown";if(o.PointerEvent){i="pointerdown"}else if("ontouchstart"in o){i="touchstart"}t[n](i,this)};r.handleEvent=function(t){var e="on"+t.type;if(this[e]){this[e](t)}};r.getTouch=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.identifier==this.pointerIdentifier){return n}}};r.onmousedown=function(t){var e=t.button;if(e&&(e!==0&&e!==1)){return}this._pointerDown(t,t)};r.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])};r.onpointerdown=function(t){this._pointerDown(t,t)};r._pointerDown=function(t,e){if(t.button||this.isPointerDown){return}this.isPointerDown=true;this.pointerIdentifier=e.pointerId!==undefined?e.pointerId:e.identifier;this.pointerDown(t,e)};r.pointerDown=function(t,e){this._bindPostStartEvents(t);this.emitEvent("pointerDown",[t,e])};var a={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};r._bindPostStartEvents=function(t){if(!t){return}var e=a[t.type];e.forEach(function(t){o.addEventListener(t,this)},this);this._boundPointerEvents=e};r._unbindPostStartEvents=function(){if(!this._boundPointerEvents){return}this._boundPointerEvents.forEach(function(t){o.removeEventListener(t,this)},this);delete this._boundPointerEvents};r.onmousemove=function(t){this._pointerMove(t,t)};r.onpointermove=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerMove(t,t)}};r.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerMove(t,e)}};r._pointerMove=function(t,e){this.pointerMove(t,e)};r.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])};r.onmouseup=function(t){this._pointerUp(t,t)};r.onpointerup=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerUp(t,t)}};r.ontouchend=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerUp(t,e)}};r._pointerUp=function(t,e){this._pointerDone();this.pointerUp(t,e)};r.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])};r._pointerDone=function(){this._pointerReset();this._unbindPostStartEvents();this.pointerDone()};r._pointerReset=function(){this.isPointerDown=false;delete this.pointerIdentifier};r.pointerDone=n;r.onpointercancel=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerCancel(t,t)}};r.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerCancel(t,e)}};r._pointerCancel=function(t,e){this._pointerDone();this.pointerCancel(t,e)};r.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])};i.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}};return i});(function(){var t=window.CubNPup={};window.TAU=Math.PI*2;for(var e in EvEmitter.prototype){t[e]=EvEmitter.prototype[e]}var n=["local","coolmathgames.com","coolmath-games.com","cubnpup-coolmathgames.netlify.com"].filter(function(t){return location.hostname.indexOf(t)!=-1});t.isLocked=n.length==0})();(function(){function t(t,e){this.type="FreeSegment";this.a=t;this.b=e;this.noon={a:t,b:e};this.three={a:{x:-t.y,y:t.x},b:{x:-e.y,y:e.x}};this.six={a:{x:-t.x,y:-t.y},b:{x:-e.x,y:-e.y}};this.nine={a:{x:t.y,y:-t.x},b:{x:e.y,y:-e.x}}}t.prototype.render=function(t,e,n){var i=this.a.x*n;var o=this.a.y*n;var r=this.b.x*n;var a=this.b.y*n;t.strokeStyle="hsla(200, 80%, 50%, 0.7)";t.lineWidth=n*.6;t.lineCap="round";t.beginPath();t.moveTo(i,o);t.lineTo(r,a);t.stroke();t.closePath()};CubNPup.FreeSegment=t})();(function(){function t(t,e){this.type="FixedSegment";this.a=t;this.b=e;this.noon={a:t,b:e};this.three={a:t,b:e};this.six={a:t,b:e};this.nine={a:t,b:e}}t.prototype.render=function(t,e,n){var i=this.a.x*n;var o=this.a.y*n;var r=this.b.x*n;var a=this.b.y*n;t.strokeStyle="hsla(30, 100%, 40%, 0.6)";t.lineWidth=n*.8;t.lineCap="round";t.beginPath();t.moveTo(i,o);t.lineTo(r,a);t.stroke();t.closePath()};CubNPup.FixedSegment=t})();(function(){function t(t,e){this.type="FreeSegment";this.a=t;this.b=e;var n=e.x-t.x;var i=e.y-t.y;this.delta={x:n,y:i};this.noon={a:t,b:e};this.three={a:{x:-t.y,y:t.x},b:{x:-t.y+n,y:t.x+i}};this.six={a:{x:-t.x,y:-t.y},b:{x:-t.x+n,y:-t.y+i}};this.nine={a:{x:t.y,y:-t.x},b:{x:t.y+n,y:-t.x+i}}}t.prototype.render=function(t,e,n,i){var o=this.a.x*n;var r=this.a.y*n;var a=this.delta.x*n;var s=this.delta.y*n;t.save();t.translate(o,r);t.rotate(-i);var u="hsla(150, 100%, 35%, 0.7)";t.strokeStyle=u;t.lineWidth=n*.4;t.lineCap="round";t.beginPath();t.moveTo(0,0);t.lineTo(a,s);t.stroke();t.closePath();t.fillStyle=u;t.beginPath();t.arc(0,0,n*.4,0,Math.PI*2);t.fill();t.closePath();t.restore()};CubNPup.PivotSegment=t})();(function(){function t(t,e){this.type="RotateSegment";this.a=t;this.b=e;var n=e.x-t.x;var i=e.y-t.y;this.delta={x:n,y:i};this.theta=Math.atan2(i,n);this.noon={a:t,b:e};this.three={a:t,b:this.getB(TAU/4)};this.six={a:t,b:this.getB(TAU/2)};this.nine={a:t,b:this.getB(TAU*3/4)}}t.prototype.getB=function(t){return{x:Math.round(this.a.x+Math.cos(this.theta+t)*2),y:Math.round(this.a.y+Math.sin(this.theta+t)*2)}};t.prototype.render=function(t,e,n,i){var o=this.a.x*n;var r=this.a.y*n;t.save();t.translate(o,r);t.rotate(i);var a="hsla(0, 100%, 50%, 0.6)";t.strokeStyle=a;t.fillStyle=a;t.lineWidth=n*.8;t.lineJoin="round";t.rotate(TAU/8);t.strokeRect(-n*.2,-n*.2,n*.4,n*.4);t.rotate(-TAU/8);t.lineWidth=n*.8;t.lineCap="round";t.beginPath();t.moveTo(0,0);var s=this.delta.x*n;var u=this.delta.y*n;t.lineTo(s,u);t.stroke();t.closePath();t.restore()};CubNPup.RotateSegment=t})();(function(){function t(t){this.angle=0;this.friction=.95;this.velocity=0;for(var e in t){this[e]=t[e]}}t.prototype.integrate=function(){this.velocity*=this.friction;this.angle+=this.velocity;this.normalizeAngle()};t.prototype.applyForce=function(t){this.velocity+=t};t.prototype.normalizeAngle=function(){this.angle=(this.angle%TAU+TAU)%TAU};t.prototype.setAngle=function(t){var e=t-this.angle;if(e>TAU/2){e-=TAU}else if(e<-TAU/2){e+=TAU}var n=e-this.velocity;this.applyForce(n)};CubNPup.FlyWheel=t})();(function(){var t=CubNPup.cub={offset:{x:0,y:0}};var n={noon:function(t){return t},three:function(t){return{x:t.y,y:-t.x}},six:function(t){return{x:-t.x,y:-t.y}},nine:function(t){return{x:-t.y,y:t.x}}};t.setPeg=function(t,e){t=n[e](t);this.peg=t;this.noon={x:t.x,y:t.y};this.three={x:-t.y,y:t.x};this.six={x:-t.x,y:-t.y};this.nine={x:t.y,y:-t.x}};var i={noon:function(t){return t},three:function(t){return{x:t.y,y:-t.x}},six:function(t){return{x:-t.x,y:-t.y}},nine:function(t){return{x:-t.y,y:t.x}}};t.setOffset=function(t,e){this.offset=i[e](t)};t.render=function(i,t,e,n,o){function r(t,e,n){i.beginPath();i.arc(t,e,n,0,Math.PI*2);i.fill();i.closePath()}var a=this.peg.x*e+this.offset.x;var s=this.peg.y*e+this.offset.y;i.save();i.translate(t.x,t.y);i.rotate(n);i.translate(a,s);i.rotate(-n);i.fillStyle="hsla(330, 100%, 40%, 1)";var u=o?1.15:1;i.scale(u,u);r(0,0,e*.6);r(e*-.45,e*-.35,e*.3);r(e*.45,e*-.35,e*.3);i.restore()}})();(function(){var d=document.querySelector(".instruction");function t(){this.freeSegments=[];this.fixedSegments=[];this.pivotSegments=[];this.rotateSegments=[];this.flyWheel=new CubNPup.FlyWheel({friction:.8});this.connections={}}t.prototype.loadText=function(t){var e=t.split("---\n");var n={};if(e.length>1){n=y(e[0])}d.innerHTML=n.instruction||"";var i=e[e.length-1];var o=i.split("\n");var r=this.gridCount=o[0].length;var a=this.gridMax=(r-1)/2;for(var s=0;s<o.length;s++){var u=o[s];var c=u.split("");for(var h=0;h<c.length;h++){var l=c[h];var p=h-a;var v=s-a;var f="parse"+l;if(this[f]){this[f](p,v)}}}};function y(t){if(!t){return}var o={};t.split("\n").forEach(function(t){if(!t){return}var e=t.split(":");var n=e[0].trim();var i=e[1].trim();if(i==="true"){i=true}else if(i==="false"){i=false}else if(i.match(/$\d+(\.\d+)?^/)){i=parseFloat(i,10)}else if(i.match(/$\d+\.\d+^/)){i=parseFloat(i)}o[n]=i});return o}t.prototype["parse-"]=t.prototype.addFreeHorizSegment=function(t,e){var n=i(t,e,CubNPup.FreeSegment);this.connectSegment(n);this.freeSegments.push(n)};t.prototype["parse|"]=t.prototype.addFreeVertSegment=function(t,e){var n=o(t,e,CubNPup.FreeSegment);this.connectSegment(n);this.freeSegments.push(n)};t.prototype["parse="]=t.prototype.addFixedHorizSegment=function(t,e){var n=i(t,e,CubNPup.FixedSegment);this.connectSegment(n);this.fixedSegments.push(n)};t.prototype["parse!"]=t.prototype.addFixedVertSegment=function(t,e){var n=o(t,e,CubNPup.FixedSegment);this.connectSegment(n);this.fixedSegments.push(n)};function i(t,e,n){var i={x:t+1,y:e};var o={x:t-1,y:e};return new n(i,o)}function o(t,e,n){var i={x:t,y:e+1};var o={x:t,y:e-1};return new n(i,o)}t.prototype["parse^"]=t.prototype.addPivotUpSegment=function(t,e){var n={x:t,y:e+1};var i={x:t,y:e-1};var o=new CubNPup.PivotSegment(n,i);this.connectSegment(o);this.pivotSegments.push(o)};t.prototype.parsev=t.prototype.addPivotDownSegment=function(t,e){var n={x:t,y:e-1};var i={x:t,y:e+1};var o=new CubNPup.PivotSegment(n,i);this.connectSegment(o);this.pivotSegments.push(o)};t.prototype["parse<"]=t.prototype.addPivotLeftSegment=function(t,e){var n={x:t+1,y:e};var i={x:t-1,y:e};var o=new CubNPup.PivotSegment(n,i);this.connectSegment(o);this.pivotSegments.push(o)};t.prototype["parse>"]=t.prototype.addPivotRightSegment=function(t,e){var n={x:t-1,y:e};var i={x:t+1,y:e};var o=new CubNPup.PivotSegment(n,i);this.connectSegment(o);this.pivotSegments.push(o)};t.prototype.parse8=t.prototype.addRotateUpSegment=function(t,e){var n={x:t,y:e+1};var i={x:t,y:e-1};var o=new CubNPup.RotateSegment(n,i);this.connectSegment(o);this.rotateSegments.push(o)};t.prototype.parse4=t.prototype.addRotateLeftSegment=function(t,e){var n={x:t+1,y:e};var i={x:t-1,y:e};var o=new CubNPup.RotateSegment(n,i);this.connectSegment(o);this.rotateSegments.push(o)};t.prototype.parse5=t.prototype.addRotateUpSegment=function(t,e){var n={x:t,y:e-1};var i={x:t,y:e+1};var o=new CubNPup.RotateSegment(n,i);this.connectSegment(o);this.rotateSegments.push(o)};t.prototype.parse6=t.prototype.addRotateRightSegment=function(t,e){var n={x:t-1,y:e};var i={x:t+1,y:e};var o=new CubNPup.RotateSegment(n,i);this.connectSegment(o);this.rotateSegments.push(o)};t.prototype["parse#"]=function(t,e){this.addFreeHorizSegment(t,e);this.addFixedHorizSegment(t,e)};t.prototype.parse$=function(t,e){this.addFreeVertSegment(t,e);this.addFixedVertSegment(t,e)};t.prototype.parseI=function(t,e){this.addPivotUpSegment(t,e);this.addFixedVertSegment(t,e)};t.prototype.parseJ=function(t,e){this.addPivotLeftSegment(t,e);this.addFixedHorizSegment(t,e)};t.prototype.parseK=function(t,e){this.addPivotDownSegment(t,e);this.addFixedVertSegment(t,e)};t.prototype.parseL=function(t,e){this.addPivotRightSegment(t,e);this.addFixedHorizSegment(t,e)};t.prototype.parseW=function(t,e){this.addPivotUpSegment(t,e);this.addFreeVertSegment(t,e)};t.prototype.parseA=function(t,e){this.addPivotLeftSegment(t,e);this.addFreeHorizSegment(t,e)};t.prototype.parseS=function(t,e){this.addPivotDownSegment(t,e);this.addFreeVertSegment(t,e)};t.prototype.parseD=function(t,e){this.addPivotRightSegment(t,e);this.addFreeHorizSegment(t,e)};t.prototype["parse@"]=function(t,e){this.startPosition={x:t,y:e};CubNPup.cub.setPeg(this.startPosition,"noon")};t.prototype["parse*"]=function(t,e){this.goalPosition={x:t,y:e}};t.prototype.updateItemGroups=function(){var e={};this.items.forEach(function(t){if(e[t.type]===undefined){e[t.type]=[]}e[t.type].push(t)});this.itemGroups=e};var e=["noon","three","six","nine"];t.prototype.connectSegment=function(n){e.forEach(function(t){var e=n[t];if(this.getIsPegOut(e.a)||this.getIsPegOut(e.b)){return}this.connectPeg(n,t,e.a);this.connectPeg(n,t,e.b)},this)};t.prototype.getIsPegOut=function(t){return Math.abs(t.x)>this.gridMax||Math.abs(t.y)>this.gridMax};t.prototype.connectPeg=function(t,e,n){var i=e+":"+n.x+","+n.y;var o=this.connections[i];if(!o){o=this.connections[i]=[]}if(o.indexOf(t)==-1){o.push(t)}};t.prototype.update=function(){this.flyWheel.integrate();var t=this.flyWheel.angle;if(t<TAU/8){this.orientation="noon"}else if(t<TAU*3/8){this.orientation="three"}else if(t<TAU*5/8){this.orientation="six"}else if(t<TAU*7/8){this.orientation="nine"}else{this.orientation="noon"}};t.prototype.attractAlignFlyWheel=function(){var t=this.flyWheel.angle;var e;if(t<TAU/8){e=0}else if(t<TAU*3/8){e=TAU/4}else if(t<TAU*5/8){e=TAU/2}else if(t<TAU*7/8){e=TAU*3/4}else{e=TAU}var n=(e-t)*.03;this.flyWheel.applyForce(n)};var f={noon:0,three:TAU/4,six:TAU/2,nine:TAU*3/4};t.prototype.render=function(e,n,i,o){var t=f[o];var r=this.gridMax;o=t!==undefined?t:o||0;e.save();e.translate(n.x,n.y);this.fixedSegments.forEach(function(t){t.render(e,n,i)});this.rotateSegments.forEach(function(t){t.render(e,n,i,o)});e.rotate(o);e.lineWidth=i*.2;e.lineCap="round";e.lineJoin="round";e.lineWidth=i*.2;e.strokeStyle="hsla(0, 0%, 50%, 0.2)";e.save();e.rotate(Math.PI/4);e.strokeRect(-i/5,-i/5,i*2/5,i*2/5);e.restore();e.strokeStyle="hsla(330, 100%, 50%, 0.3)";e.lineWidth=i*.15;var a=this.startPosition.x*i;var s=this.startPosition.y*i;m(e,a,s,i*.5);for(var u=-r;u<=r;u+=2){for(var c=-r;c<=r;c+=2){var h=c*i;var l=u*i;e.fillStyle="hsla(0, 0%, 50%, 0.6)";g(e,h,l,i*.15)}}this.freeSegments.forEach(function(t){t.render(e,n,i)});this.pivotSegments.forEach(function(t){t.render(e,n,i,o)});var p=this.goalPosition.x*i;var v=this.goalPosition.y*i;e.lineWidth=i*.3;e.fillStyle="hsla(50, 100%, 50%, 1)";e.strokeStyle="hsla(50, 100%, 50%, 1)";x(e,p,v,o,i*.6,i*.3);e.restore()};function g(t,e,n,i){t.beginPath();t.arc(e,n,i,0,TAU);t.fill();t.closePath()}function m(t,e,n,i){t.beginPath();t.arc(e,n,i,0,TAU);t.stroke();t.closePath()}function x(t,e,n,i,o,r){t.save();t.translate(e,n);t.rotate(-i);t.beginPath();for(var a=0;a<11;a++){var s=TAU*a/10+Math.PI/2;var u=a%2?o:r;var c=Math.cos(s)*u;var h=Math.sin(s)*u;t[a?"lineTo":"moveTo"](c,h)}t.fill();t.stroke();t.closePath();t.restore()}CubNPup.Maze=t})();(function(){function t(t,e){this.x=t;this.y=e;this.startTime=new Date;this.isPlaying=true}var e=1e3;t.prototype.update=function(){if(!this.isPlaying){return}this.t=(new Date-this.startTime)/e;this.isPlaying=this.t<=1};t.prototype.render=function(t,e){if(!this.isPlaying){return}t.save();t.translate(this.x,this.y);var n=e*.03;t.scale(n,n);this.renderBurst(t);t.save();t.scale(.5,-.5);this.renderBurst(t);t.restore();t.restore()};t.prototype.renderBurst=function(t){var e=this.t;var n=1-e;var i=1-n*n*n*n*n*n*n*n;var o=i*-100;var r=(1-e*e*e)*1.5;var a=Math.PI*1*e*e*e;for(var s=0;s<5;s++){t.save();t.rotate(TAU/5*s);t.translate(0,o);t.scale(r,r);t.rotate(a);u(t);t.restore()}};function u(t){t.lineWidth=8;t.lineJoin="round";t.lineCap="round";t.fillStyle="hsla(50, 100%, 50%, 1)";t.strokeStyle="hsla(50, 100%, 50%, 1)";t.beginPath();for(var e=0;e<10;e++){var n=TAU*e/10+Math.PI/2;var i=e%2?20:10;var o=Math.cos(n)*i;var r=Math.sin(n)*i;t[e?"lineTo":"moveTo"](o,r)}t.closePath();t.fill();t.stroke()}CubNPup.WinAnimation=t})();(function(){if(CubNPup.isLocked){return}var t=document.querySelector(".level-menu");var a=document.querySelector(".level-list");var s=document.querySelector(".levels");var u=[];(function(){var t=s.querySelectorAll("pre");var e=document.createDocumentFragment();for(var n=0;n<t.length;n++){var i=t[n];var o=document.createElement("li");o.className="level-list__item";var r=i.id;o.innerHTML='<span class="level-list__item__number">'+(n+1)+'</span> <span class="level-list__item__blurb">'+i.getAttribute("data-blurb")+"</span>"+'<span class="level-list__item__check">'+'<svg viewBox="0 0 16 16" width="16" height="16">'+'<path d="M 2.5,7.5 L 6.5,11.5 L 13.5 4.5" />'+"</svg>"+"</span>";o.setAttribute("data-id",r);if(n===0){o.classList.add("is-enabled")}e.appendChild(o);u.push(r)}a.appendChild(e)})();a.addEventListener("click",function(t){var e=t.target.closest(".level-list__item.is-enabled");if(!e){return}var n=e.getAttribute("data-id");i(n)});function e(){t.classList.add("is-open")}function r(){t.classList.remove("is-open")}CubNPup.on("openLevelMenu",e);CubNPup.on("closeLevelMenu",r);document.querySelector(".level-menu__close-button").addEventListener("click",r);var c=localStorage.getItem("completedLevels");c=c?c.split(","):[];CubNPup.markLevelCompleted=function(t){var e=a.querySelector('[data-id="'+t+'"]');if(!e){return}e.classList.add("did-complete");e.classList.add("is-enabled");if(e.nextSibling){e.nextSibling.classList.add("is-enabled")}if(c.indexOf(t)==-1){c.push(t);localStorage.setItem("completedLevels",c.join(","))}};CubNPup.on("markLevelCompleted",CubNPup.markLevelCompleted);CubNPup.getNextLevel=function(){var t=u.indexOf(CubNPup.activeMaze.id);return u[t+1]};window.unlockAllLevels=function(){var t=a.querySelectorAll(".level-list__item");for(var e=0;e<t.length;e++){t[e].classList.add("is-enabled")}};function i(t){if(!t){return}var e=s.querySelector("#"+t);if(!e){console.error("pre not found for "+t);return}var n=CubNPup.activeMaze=new CubNPup.Maze;n.id=t;n.loadText(e.textContent);CubNPup.emitEvent("levelLoaded")}CubNPup.on("loadLevel",i);CubNPup.on("loadNextLevel",function(){i(CubNPup.getNextLevel())});CubNPup.on("levelLoaded",function(){var t=CubNPup.activeMaze.id;r();var e=a.querySelector(".is-playing");if(e){e.classList.remove("is-playing")}a.querySelector('[data-id="'+t+'"]').classList.add("is-playing");localStorage.setItem("currentLevel",t);var n=u.indexOf(t)+1;var i=c.indexOf(t)!=-1;var o=i?"replay":"start";(parent.cmgGameEvent||console.log)(o,n)});a.addEventListener("click",function(t){var e=t.target.closest(".level-list__item.is-enabled");if(!e){return}var n=e.getAttribute("data-id");i(n)});var n=localStorage.getItem("currentLevel")||u[0];i(n);c.forEach(CubNPup.markLevelCompleted)})();(function(){if(CubNPup.isLocked){return}var i=document.documentElement;var t=document.querySelector("canvas");var o=t.getContext("2d");var r=null;var a=null;var s=false;var u=false;var e=new Unipointer;var c=CubNPup.cub;var h=CubNPup.activeMaze;var n;var l,p,v,f,d,y,g;function m(){l=Math.min(window.innerWidth,window.innerHeight*2/3);p=t.width=l*2;d=t.height=l*2;setTimeout(function(){v=t.offsetLeft;f=t.offsetTop});t.style.width=l+"px";t.style.height=l+"px";y=l/14;g={x:l/2,y:l/2}}window.addEventListener("resize",m);m();document.querySelector(".level-select-button").addEventListener("click",function(){CubNPup.emitEvent("openLevelMenu")});var x=document.querySelector(".next-level-button");x.addEventListener("click",function(){CubNPup.emitEvent("loadNextLevel")});CubNPup.on("levelLoaded",function(){h=CubNPup.activeMaze;x.classList.remove("is-open");window.scrollTo(0,0)});var b=document.querySelector(".play-surface");e.bindStartEvent(b);window.addEventListener("mousemove",X);I();var S=document.querySelector(".splash-screen");S.addEventListener("transitionend",function(){S.style.display="none"});setTimeout(function(){S.style.opacity=0},1e3);var P;var C={};var T={};e.pointerDown=function(t,e){t.preventDefault();var n=E(e);P=n?C:T;P.pointerDown(t,e);this._bindPostStartEvents(t)};function E(t){var e=_(t);var n=c[h.orientation];var i=Math.abs(e.x-n.x*y);var o=Math.abs(e.y-n.y*y);var r=y*1.5;return i<=r&&o<=r}function _(t){var e=t.pageX-v;var n=t.pageY-f;return{x:e-g.x,y:n-g.y}}e.pointerMove=function(t,e){t.preventDefault();P.pointerMove(t,e)};e.pointerUp=function(t,e){P.pointerUp(t,e);this._unbindPostStartEvents()};var w,L,N;C.pointerDown=function(t,e){var n=R();if(!n||!n.length){return}u=true;w={x:e.pageX,y:e.pageY};L={x:c[h.orientation].x*y+g.x,y:c[h.orientation].y*y+g.y};i.classList.add("is-cub-dragging")};C.pointerMove=function(t,e){if(!u){return}a={x:e.pageX-w.x,y:e.pageY-w.y}};C.pointerUp=function(){a=null;i.classList.remove("is-cub-dragging");u=false;c.setOffset({x:0,y:0},h.orientation);var t=h.goalPosition;if(c.peg.x==t.x&&c.peg.y==t.y){U()}};function U(){var t=q();n=new CubNPup.WinAnimation(t.x,t.y);CubNPup.markLevelCompleted(h.id);if(CubNPup.getNextLevel()){setTimeout(function(){x.classList.add("is-open")},1e3)}}var A,M,F;T.pointerDown=function(t,e){A=F=k(e);M=h.flyWheel.angle;r=M;N=e};function k(t){var e=_(t);return $(Math.atan2(e.y,e.x))}T.pointerMove=function(t,e){N=e;F=k(e);var n=F-A;r=$(M+n)};T.pointerUp=function(){r=null;N=null};function I(){D();Y();requestAnimationFrame(I)}function D(){W();if(r){h.flyWheel.setAngle(r)}else{h.attractAlignFlyWheel()}h.update();if(n){n.update()}}function W(){if(!a){return}var t=R();var e={x:L.x+a.x,y:L.y+a.y};var n=V(t,e);c.setPeg(n,h.orientation);var i=z(t,e);var o=q();var r={x:i.x-o.x,y:i.y-o.y};c.setOffset(r,h.orientation)}function q(){return{x:c[h.orientation].x*y+g.x,y:c[h.orientation].y*y+g.y}}function R(){var t=c[h.orientation].x;var e=c[h.orientation].y;var n=h.orientation+":"+t+","+e;return h.connections[n]}function z(t,n){if(t.length==1){return O(t[0],n)}var e=t.map(function(t){var e=O(t,n);return{position:e,distance:J(n,e)}});e.sort(B);return e[0].position}function O(t,e){var n=t[h.orientation];var i=n.a.y==n.b.y;var o,r;if(i){o=H(n,"x",e);r=n.a.y*y+g.y}else{o=n.a.x*y+g.x;r=H(n,"y",e)}return{x:o,y:r}}function H(t,e,n){var i=t.a[e];var o=t.b[e];var r=i<o?i:o;var a=i>o?i:o;r=r*y+g[e];a=a*y+g[e];return Math.max(r,Math.min(a,n[e]))}function B(t,e){return t.distance-e.distance}function V(t,o){var n=[];t.forEach(function(t){var e=t[h.orientation];j(e.a,n);j(e.b,n)});var e=n.map(function(t){var e=t.split(",");var n={x:parseInt(e[0],10),y:parseInt(e[1],10)};var i={x:n.x*y+g.x,y:n.y*y+g.y};return{peg:n,distance:J(o,i)}});e.sort(B);return e[0].peg}function J(t,e){var n=e.x-t.x;var i=e.y-t.y;return Math.sqrt(n*n+i*i)}function j(t,e){var n=t.x+","+t.y;if(e.indexOf(n)==-1){e.push(n)}}function X(t){var e=E(t);if(e==s){return}s=e;var n=e?"add":"remove";i.classList[n]("is-cub-hovered")}function Y(){o.clearRect(0,0,p,d);o.save();o.scale(2,2);G();h.render(o,g,y,h.flyWheel.angle);if(n){n.render(o,y)}var t=s||u;c.render(o,g,y,h.flyWheel.angle,t);o.restore()}function G(){if(!N){return}o.lineCap="round";o.lineJoin="round";o.lineWidth=y*.5;var t="#EEE";o.strokeStyle=t;o.fillStyle=t;o.beginPath();var e=h.gridMax*y;o.moveTo(g.x,g.y);var n=$($(F)-$(A))>TAU/2;o.arc(g.x,g.y,e,A,F,n);o.lineTo(g.x,g.y);o.stroke();o.fill();o.closePath()}function $(t){return(t%TAU+TAU)%TAU}})();